package com.amazingReader.control.Chen;

import com.amazingReader.service.Interface.OfflineReadService;
import nl.siegmann.epublib.domain.*;
import nl.siegmann.epublib.epub.EpubWriter;
import org.apache.ibatis.javassist.Translator;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.*;

@Controller
public class OffLineReadControl {
    @Autowired
    private OfflineReadService offlineReadService;

    @RequestMapping("/downLoadFreeChapters.action")
    public void downLoadFreeChapter(HttpServletRequest request, HttpServletResponse response){
        String path = request.getContextPath();
        String basePath = request.getScheme()+"://"+request.getServerName()+":"+request.getServerPort()+path+"/";
        Book book = new Book();
        Integer bookId = null;

        Integer readerId = ((com.amazingReader.entity.Reader)request.getSession().getAttribute("reader")).getReaderId();
        try {
            bookId = Integer.parseInt(request.getParameter("bookId"));
        }catch (Exception e){
        }
        book = offlineReadService.getFreeAndBoughtChaptersOfBook(basePath,bookId,readerId);
        //下面是下载代码
    }
}
