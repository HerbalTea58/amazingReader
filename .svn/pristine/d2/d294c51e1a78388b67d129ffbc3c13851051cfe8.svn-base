<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.amazingReader.mapper.ReaderOrderMapper">
    <!--boolean add(ReaderOrder readerOrder);-->
    <insert id="add" parameterType="ReaderOrder">
        insert into reader_order(reader_order_type_id,reader_order_price,
                  reader_order_object_id,reader_order_time,reader_order_detail,reader_id)
        values(#{readerOrderTypeId},
        #{readerOrderPrice},#{readerOrderObjectId},#{readerOrderTime},
        #{readerOrderDetail},#{readerId})

    </insert>

    <select id="getLastInsertId" resultType="int">
        SELECT LAST_INSERT_ID()
    </select>

    <!--boolean alter(ReaderOrder readerOrder);-->
    <update id="alter" parameterType="ReaderOrder">
        update reader_order set reader_order_type_id=#{readerOrderTypeId},reader_order_price=#{readerOrderPrice},
        reader_order_object_id=#{readerOrderObjectId},reader_order_time=#{readerOrderTime},
        reader_order_detail=#{readerOrderDetail} where reader_id=#{readerId}
    </update>

    <!--boolean remove(int ReaderOrderDetailId);-->
    <delete id="remove" parameterType="int">
        delete from reader_order where reader_order_id=#{_parameter}
    </delete>

   <!-- &lt;!&ndash;List<ReaderOrderDetail> getOrderDetail(int orderId);
    List<ReaderOrderDetail> getOrderDetail(int orderId)&ndash;&gt;
    <select id="getOrderDetail" parameterType="int" resultType="ReaderOrderDetail">
        select * from reader_order_detail where reader_order_id=#{_parameter}
    </select>-->
    <!--ReaderOrder getOrderByOrderID(int orderId);-->
    <select id="getOrderByOrderID" parameterType="int" resultType="ReaderOrder">
        select * from reader_order where reader_order_id=#{_parameter}
    </select>

    <!--List<ReaderOrder> getOrdersByReaderId(int readerId);-->
    <select id="getOrdersByReaderId" parameterType="int" resultType="ReaderOrder">
        select * from reader_order where reader_id=#{_parameter}
    </select>

    <!-- db验证 double IncomeOfType(int writerId, int type);-->
    <select id="IncomeOfType" resultType="Integer">
        SELECT COALESCE (sum(reader_order_price),0 )from reader_order where reader_order_object_id=#{0}
        and reader_order_type_id=#{1}
    </select>

   <!--
    /**
    * 获取某位作者的总打赏金额
    */
    double getRewardIncomeOfWriter(int writerId);  dbOK
    /**
    * 获取某位作者的某月打赏金额  dbOK
    */
    double getMonthRewardIncomeOfWriter(String year,String month,int writerId);-->
    <select id="getRewardIncomeOfWriter" resultType="Integer">
        SELECT COALESCE (SUM(reader_order_price),0)
        FROM reader_order left join book on reader_order_object_id = book_id
        WHERE  book_writer_id = #{param}
    </select>

    <select id="getMonthRewardIncomeOfWriter" resultType="Integer">
        SELECT COALESCE (SUM(reader_order_price),0)
        FROM reader_order left join book on reader_order_object_id = book_id
        WHERE  book_writer_id = #{param3} and reader_order_time LIKE CONCAT( '%' , #{param1} , '-' ,#{param2}, '%' )

    </select>
</mapper>